{% extends "base.html" %}

{% block title %}API kaliti dostuplari — {{ api_key.name }}{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{{ url_for('admin.api_keys') }}" class="text-primary-600 hover:underline">← API kalitlari ro'yxatiga qaytish</a>
</div>
<div class="max-w-2xl">
    <h1 class="text-2xl font-bold text-gray-900 mb-2">Dostuplar: {{ api_key.name }}</h1>
    <p class="text-gray-600 mb-6">Ushbu kalit qaysi API resurslariga kirish huquqiga ega ekanini ON/OFF kalitlar bilan belgilang.</p>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
        <form method="POST" action="{{ url_for('admin.api_key_edit', key_id=api_key.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {% set key_perms = api_key.get_permissions_list() %}
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-6">
                {% for code, label in permissions_list %}
                <label class="perm-row flex items-center justify-between gap-2 p-2 rounded-lg border border-gray-200 hover:border-gray-300 cursor-pointer transition-colors">
                    <span class="text-xs font-medium text-gray-700">{{ label }}</span>
                    <div class="flex items-center gap-1.5 shrink-0">
                        <span class="perm-off text-[10px] font-semibold uppercase {% if code in key_perms %}hidden{% endif %}" style="color: #dc2626;">OFF</span>
                        <input type="checkbox" name="permissions" value="{{ code }}" class="sr-only perm-cb" {% if code in key_perms %}checked{% endif %}>
                        <div class="perm-track relative w-10 h-5 rounded-full transition-colors duration-200 {% if code in key_perms %}bg-green-500{% else %}bg-red-500{% endif %}">
                            <div class="perm-thumb absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform duration-200" style="transform: {% if code in key_perms %}translateX(20px){% else %}translateX(0){% endif %};"></div>
                        </div>
                        <span class="perm-on text-[10px] font-semibold uppercase {% if code not in key_perms %}hidden{% endif %}" style="color: #16a34a;">ON</span>
                    </div>
                </label>
                {% endfor %}
            </div>
            <div class="flex gap-3">
                <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition-colors">
                    Saqlash
                </button>
                <a href="{{ url_for('admin.api_keys') }}" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors">
                    Bekor qilish
                </a>
            </div>
        </form>
    </div>
</div>
<script>
document.querySelectorAll('.perm-row').forEach(function(row) {
    var cb = row.querySelector('.perm-cb');
    var track = row.querySelector('.perm-track');
    var thumb = row.querySelector('.perm-thumb');
    var offSpan = row.querySelector('.perm-off');
    var onSpan = row.querySelector('.perm-on');
    function sync() {
        var on = cb.checked;
        track.classList.toggle('bg-green-500', on);
        track.classList.toggle('bg-red-500', !on);
        thumb.style.transform = on ? 'translateX(20px)' : 'translateX(0)';
        offSpan.classList.toggle('hidden', on);
        onSpan.classList.toggle('hidden', !on);
    }
    cb.addEventListener('change', sync);
});
</script>
{% endblock %}
