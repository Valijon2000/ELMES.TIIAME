{% extends "base.html" %}

{% block title %}Yangi guruh{% endblock %}

{% block content %}
<div class="w-full mx-auto">
    <div class="mb-6">
        <a href="{% if faculty_id %}{{ url_for('admin.faculty_detail', id=faculty_id) }}{% else %}{{ url_for('admin.groups') }}{% endif %}"
            class="text-gray-500 hover:text-gray-700 flex items-center gap-2 mb-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Orqaga
        </a>
        <h1 class="text-2xl font-bold text-gray-900">Yangi guruh</h1>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
        <form method="POST" class="space-y-6">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="faculty_id" value="{{ faculty_id }}" />

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Fakultet (avtomatik) -->
                {% if faculty %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Fakultet</label>
                    <input type="text" value="{{ faculty.name }}" disabled
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-600">
                    <p class="text-xs text-gray-500 mt-1">Fakultet avtomatik tanlangan</p>
                </div>
                {% else %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Fakultet *</label>
                    <select name="faculty_id" id="facultySelect" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        <option value="">Tanlang...</option>
                        {% for fac in faculties %}
                        <option value="{{ fac.id }}" {% if faculty_id==fac.id %}selected{% endif %}>{{ fac.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}

                <!-- Qabul yili -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Qabul yili *</label>
                    <input type="number" name="enrollment_year" id="enrollmentYearInput" placeholder="2025" min="1900"
                        max="2100" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                </div>

                <!-- Kurs -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kurs *</label>
                    <select name="course_year" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        <option value="">Tanlang...</option>
                        {% for i in range(1, 8) %}
                        <option value="{{ i }}">{{ i }}-kurs</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Semestr -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Semestr *</label>
                    <select name="semester" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        <option value="">Tanlang...</option>
                        {% for i in range(1, 15) %}
                        <option value="{{ i }}">{{ i }}-semestr</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Ta'lim shakli -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ta'lim shakli *</label>
                    <select name="education_type" id="educationTypeSelect" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        <option value="">Tanlang...</option>
                        <option value="kunduzgi">Kunduzgi</option>
                        <option value="sirtqi">Sirtqi</option>
                        <option value="masofaviy">Masofaviy</option>
                        <option value="kechki">Kechki</option>
                    </select>
                </div>

                <!-- Guruh nomi -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Guruh nomi *</label>
                    <input type="text" name="name" required placeholder="Masalan: DI-21"
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all uppercase">
                </div>

                <!-- Yo'nalish -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Yo'nalish *</label>
                    <select name="direction_id" id="directionSelect" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        <option value="">Tanlang...</option>
                        {% for direction in all_directions %}
                        <option value="{{ direction.id }}" data-code="{{ direction.code }}"
                            data-name="{{ direction.name }}" {% if direction_id==direction.id %}selected{% endif %}>
                            {{ direction.formatted_direction }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Tavsif (Full Width) -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tavsif</label>
                    <textarea name="description" rows="3" placeholder="Guruh haqida qisqacha tavsif (ixtiyoriy)"
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all resize-none"></textarea>
                </div>
            </div>

            <div class="pt-6 border-t border-gray-100 flex gap-3">
                <button type="submit"
                    class="flex-1 px-4 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition-colors font-medium">
                    Saqlash
                </button>
                <a href="{% if faculty_id %}{{ url_for('admin.faculty_detail', id=faculty_id) }}{% else %}{{ url_for('admin.groups') }}{% endif %}"
                    class="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-medium">
                    Bekor qilish
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    function updateDirectionLabels() {
        const year = document.getElementById('enrollmentYearInput').value || '____';
        const eduTypeSelect = document.getElementById('educationTypeSelect');
        const eduType = eduTypeSelect.options[eduTypeSelect.selectedIndex]?.text || '____';
        const directionSelect = document.getElementById('directionSelect');

        Array.from(directionSelect.options).forEach(option => {
            if (!option.value) return;

            const code = option.getAttribute('data-code');
            const name = option.getAttribute('data-name');

            if (code && name) {
                option.textContent = `${year} - ${code} - ${name} (${eduType})`;
            }
        });
    }

    document.getElementById('enrollmentYearInput').addEventListener('input', updateDirectionLabels);
    document.getElementById('educationTypeSelect').addEventListener('change', updateDirectionLabels);
    document.addEventListener('DOMContentLoaded', updateDirectionLabels);
</script>
{% endblock %}
